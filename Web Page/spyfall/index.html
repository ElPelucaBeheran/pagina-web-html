<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spyfall Web</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap');
    /* Carga local de BBH Bogle; coloca tu archivo .ttf junto a index.html y ajusta el nombre si difiere */
    @font-face {
      font-family: "BBH Bogle";
      src: url("./BBHBogle-Regular.ttf") format("truetype");
      font-weight: 400 700;
      font-style: normal;
      font-display: swap;
    }
    .bbh-bogle-regular {
      font-family: "BBH Bogle", sans-serif;
      font-weight: 400;
      font-style: normal;
    }
    body {
      font-family: 'BBH Bogle', 'Montserrat', 'Arial', sans-serif;
      background: #ffffff;
      color: #0f172a;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    .card {
      background: #f9fafb;
      padding: 24px;
      border-radius: 16px;
      text-align: center;
      width: 340px;
      border: 1px solid #e5e7eb;
    }
    label {
      display: block;
      margin-top: 12px;
      text-align: center;
    }
    #text {
      font-size: 22px;
      font-weight: 400;
      margin-bottom: 22px;
    }
    :root { --field-width: 280px; }
    input, button {
      margin: 8px auto 0 auto;
      padding: 10px;
      width: 100%;
      max-width: var(--field-width);
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: #e5e7eb;
      color: #111827;
      font-size: 16px;
    }
    input { text-align: center; }
    .stepper { display: flex; gap: 0; justify-content: center; margin-top: 4px; }
    .mini-btn {
      width: 40px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #f8fafc;
      color: #0f172a;
      font-weight: 400;
      cursor: pointer;
      transition: transform 0.06s ease, filter 0.2s ease;
      margin: 10px 10px;
    }
    .mini-btn--inc { background: #10b981; color: #ffffff; border-color: #10b981; }
    .mini-btn--inc:hover { filter: brightness(1.05); }
    .mini-btn--dec { background: #ef4444; color: #ffffff; border-color: #ef4444; }
    .mini-btn--dec:hover { filter: brightness(1.05); }
    .mini-btn:hover { filter: brightness(1.03); }
    .mini-btn:active { transform: translateY(1px); }
    button {
      cursor: pointer;
      border: none;
      background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
      color: #ffffff;
      font-weight: 400;
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.35);
      transition: transform 0.06s ease, box-shadow 0.2s ease, filter 0.2s ease;
    }
    button:hover { filter: brightness(1.05); }
    button:active { transform: translateY(1px); box-shadow: 0 4px 14px rgba(37, 99, 235, 0.3); }
    button:disabled {
      cursor: not-allowed;
      background: #93c5fd;
      box-shadow: none;
      opacity: 0.8;
    }
    button:focus-visible { outline: 3px solid #93c5fd; outline-offset: 2px; }
    #avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin: 0 auto 12px;
      overflow: hidden;
      background-color: #334155;
      display: none;
    }
    #avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    #logo {
      width: calc((var(--field-width) - 5px) * 1.2);
      margin: 0 auto 20px;
    }
    #logo img {
      width: 100%;
      display: block;
    }
    .footer-link {
      position: fixed;
      bottom: 10px;
      right: 12px;
      font-size: 14px;
    }
    .footer-link a {
      color: #2563eb;
      text-decoration: none;
    }
    .footer-link a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="card">
    <div id="logo"><img src="./logoprincipal.png.png" alt="Spyfall"></div>
    <div id="avatar"></div>
    <h1 id="title" style="display:none"></h1>
    <p id="text">Configura la partida</p>

    <label for="playersInput">Cantidad de jugadores</label>
    <input id="playersInput" type="number" min="2" value="4">
    <div class="stepper" id="playersStepper" aria-label="Ajustar jugadores">
      <button type="button" id="playersDec" class="mini-btn mini-btn--dec" aria-label="Restar jugadores">−</button>
      <button type="button" id="playersInc" class="mini-btn mini-btn--inc" aria-label="Sumar jugadores">+</button>
    </div>

    <label for="spiesInput">Cantidad de espias (max 10)</label>
    <input id="spiesInput" type="number" min="1" max="10" value="1">
    <div class="stepper" id="spiesStepper" aria-label="Ajustar espias">
      <button type="button" id="spiesDec" class="mini-btn mini-btn--dec" aria-label="Restar espias">−</button>
      <button type="button" id="spiesInc" class="mini-btn mini-btn--inc" aria-label="Sumar espias">+</button>
    </div>

    <button id="actionBtn">Empezar</button>
  </div>

  <script>
    let locationsList = [];

    async function loadLocations() {
      try {
        // Ajuste: el archivo se llama palabras.txt.txt en el workspace
        const response = await fetch('./palabras.txt.txt');
        const text = await response.text();
        // Dividir por líneas (Windows/Unix)
        locationsList = text
          .split(/\r?\n/)
          .map(l => l.trim())
          .filter(l => l.length > 0);
      } catch (e) {
        alert('No se pudo cargar palabras.txt');
        console.error(e);
      }
    }

    loadLocations();

    let players = 0;
    let spies = [];
    let currentPlayer = 0;
    let gameLocation = "";
    let state = "setup"; // setup | show | pass | reset

    const title = document.getElementById("title");
    const text = document.getElementById("text");
    const btn = document.getElementById("actionBtn");
    const playersInput = document.getElementById("playersInput");
    const spiesInput = document.getElementById("spiesInput");
    const avatar = document.getElementById("avatar");
    const playersStepper = document.getElementById("playersStepper");
    const spiesStepper = document.getElementById("spiesStepper");
    const playersDec = document.getElementById("playersDec");
    const playersInc = document.getElementById("playersInc");
    const spiesDec = document.getElementById("spiesDec");
    const spiesInc = document.getElementById("spiesInc");

    btn.addEventListener("click", handleClick);
        // Stepper handlers
        playersDec.addEventListener("click", () => {
          const min = Number(playersInput.min) || 2;
          const val = Math.max(min, Number(playersInput.value) - 1);
          playersInput.value = String(val);
          // Ajustar espías si quedaron fuera de rango
          const spyMax = Number(spiesInput.max) || 10;
          spiesInput.value = String(Math.min(spyMax, Math.max(Number(spiesInput.min) || 1, Number(spiesInput.value))));
          if (Number(spiesInput.value) >= val) spiesInput.value = String(Math.max(Number(spiesInput.min) || 1, val - 1));
        });

        playersInc.addEventListener("click", () => {
          const val = Number(playersInput.value) + 1;
          playersInput.value = String(val);
          const spyMax = Number(spiesInput.max) || 10;
          spiesInput.value = String(Math.min(spyMax, Number(spiesInput.value)));
          if (Number(spiesInput.value) >= val) spiesInput.value = String(Math.max(Number(spiesInput.min) || 1, val - 1));
        });

        spiesDec.addEventListener("click", () => {
          const min = Number(spiesInput.min) || 1;
          spiesInput.value = String(Math.max(min, Number(spiesInput.value) - 1));
        });

        spiesInc.addEventListener("click", () => {
          const max = Number(spiesInput.max) || 10;
          let next = Number(spiesInput.value) + 1;
          const playersVal = Number(playersInput.value);
          // Espías no pueden ser >= jugadores
          if (next >= playersVal) next = playersVal - 1;
          spiesInput.value = String(Math.min(max, next));
        });
    // Accessibilidad: Enter/Space activan el botón
    btn.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        handleClick();
      }
    });

    function handleClick() {
      if (state === "setup") startGame();
      else if (state === "show") passPhone();
      else if (state === "pass") showCard();
      else if (state === "reset") resetGame();
    }

    async function startGame() {
      btn.disabled = true;
      players = Number(playersInput.value);
      const spyCount = Math.min(Number(spiesInput.value), 10);

      if (players < 2 || spyCount < 1 || spyCount >= players) {
        alert("Datos invalidos");
        btn.disabled = false;
        return;
      }

      spies = [];
      while (spies.length < spyCount) {
        const r = Math.floor(Math.random() * players);
        if (!spies.includes(r)) spies.push(r);
      }

      if (locationsList.length === 0) {
        alert('La lista de lugares esta vacia o no se cargo palabras.txt');
        btn.disabled = false;
        return;
      }

      gameLocation = locationsList[Math.floor(Math.random() * locationsList.length)];
      currentPlayer = 0;

      playersInput.style.display = "none";
      spiesInput.style.display = "none";
      playersStepper.style.display = "none";
      spiesStepper.style.display = "none";
      document.querySelector("label[for='playersInput']").style.display = "none";
      document.querySelector("label[for='spiesInput']").style.display = "none";

      showCard();
      btn.disabled = false;
    }

    function renderRoleDescription(isSpy) {
      // Limpia y vuelve a crear el contenido del texto con formato
      text.innerHTML = "";

      const line1 = document.createElement("div");
      const span1 = document.createElement("span");
      span1.textContent = isSpy ? "Sos ESPIA" : "Sos Civil";
      line1.appendChild(span1);

      const line2 = document.createElement("div");
      const termLabel = document.createTextNode("Termino: ");
      const span2 = document.createElement("span");
      span2.textContent = isSpy ? "?" : gameLocation;
      line2.appendChild(termLabel);
      line2.appendChild(span2);

      text.appendChild(line1);
      text.appendChild(line2);
    }

    function showCard() {
      title.textContent = `Jugador ${currentPlayer + 1}`;
      avatar.style.display = "block";

      if (spies.includes(currentPlayer)) {
        renderRoleDescription(true);
        avatar.innerHTML = '<img src="./logoespia.png.png" alt="Espia">';
      } else {
        renderRoleDescription(false);
        avatar.innerHTML = '<img src="./logocivil.png.png" alt="Civil">';
      }

      btn.textContent = "Siguiente jugador";
      state = "show";
    }

    function passPhone() {
      btn.disabled = true;
      currentPlayer++;

      if (currentPlayer >= players) {
        title.textContent = "Listo";
        text.textContent = "Todos recibieron su carta. Empieza el juego.";
        avatar.style.display = "none";
        btn.textContent = "Resetear";
        state = "reset";
        btn.disabled = false;
        return;
      }

      title.textContent = "Pasa el celular";
      text.textContent = "Entrega el celular al siguiente jugador y no mires.";
      avatar.style.display = "block";
      avatar.innerHTML = '<img src="./pasecelular.png.png" alt="Pasar celular">';
      btn.textContent = "Mostrar carta";
      state = "pass";
      // breve reactivación para evitar doble clics accidentales
      setTimeout(() => { btn.disabled = false; }, 100);
    }

    function resetGame() {
      btn.disabled = true;
      title.textContent = "Spyfall";
      text.textContent = "Configura la partida";

      playersInput.style.display = "block";
      spiesInput.style.display = "block";
      playersStepper.style.display = "flex";
      spiesStepper.style.display = "flex";
      document.querySelector("label[for='playersInput']").style.display = "block";
      document.querySelector("label[for='spiesInput']").style.display = "block";

      avatar.style.display = "none";
      avatar.innerHTML = "";

      btn.textContent = "Empezar";

      players = 0;
      spies = [];
      currentPlayer = 0;
      gameLocation = "";
      state = "setup";
      setTimeout(() => { btn.disabled = false; }, 50);
    }
  </script>

  <div class="card" style="margin-top: 20px; margin-bottom: 30px;">
    <p style="font-size: 22px; font-weight: 400; text-align: left; line-height: 1.6;">Spyfall es un juego donde todos los jugadores reciben el mismo concepto, excepto uno o más que son los espías y no lo conocen. Por turnos, cada jugador dice una palabra o idea relacionada con el concepto, sin nombrarlo directamente. Los espías escuchan y tratan de adivinar el concepto, diciendo algo que no los delate. Al final de cada ronda, los jugadores deciden si acusan a alguien de ser espía, y los espías pueden intentar decir cuál creen que es el concepto si son elegidos.</p>
  </div>

  <div class="footer-link">
    <a href="https://elpelucabeheran.online" target="_blank">elpelucabeheran.online</a>
  </div>
</body>
</html>
